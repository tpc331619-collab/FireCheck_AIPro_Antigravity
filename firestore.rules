rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 位置圖集合
    match /maps/{mapId} {
      allow read, write: if request.auth != null;
    }
    
    // 檢查報告集合 (Legacy)
    match /reports/{reportId} {
      allow read, write: if request.auth != null;
      
      match /items/{itemId} {
        allow read, write: if request.auth != null;
      }
    }

    // 檢查報告集合 (Year-based Dynamic Collections)
    match /{collectionName}/{reportId} {
      allow read, write: if request.auth != null && collectionName.matches('^reports_[0-9]+$');
      
      match /items/{itemId} {
        allow read, write: if request.auth != null;
      }
    }
    
    // 設備定義集合
    match /equipments/{equipmentId} {
      allow read, write: if request.auth != null;
    }
    
    // 設備階層集合
    match /hierarchies/{userId} {
      allow read, write: if request.auth != null;
    }
    
    // 系統設定集合
    match /settings/{settingId} {
      allow read, write: if request.auth != null;
    }
    
    // 異常複檢記錄集合
    match /abnormalRecords/{recordId} {
      allow read, write: if request.auth != null;
    }

    // 健康指標集合
    match /health/{indicatorId} {
      allow read, write: if request.auth != null;
    }

    // 健康歷史記錄集合
    match /healthHistory/{historyId} {
      allow read, write: if request.auth != null;
    }
  }
}
